{% extends 'base.html' %}
{% block content %}
<div class="max-w-2xl mx-auto mt-10 p-6 bg-white rounded shadow">
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-2xl font-bold">마이페이지</h1>
    <a href="{{ url_for('posts.dashboard') }}" class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 font-semibold text-sm">홈으로</a>
  </div>
  <div class="mb-6">
    <div class="flex items-center gap-4 mb-2 justify-between">
      <div class="flex items-center gap-4">
        <div class="w-12 h-12 rounded-full bg-gray-200 flex items-center justify-center text-2xl text-gray-500">
          <i class="fa fa-user"></i>
        </div>
        <div>
          <div class="font-semibold text-lg">{{ user.name if user else '로그인 필요' }}</div>
          <div class="text-gray-500 text-sm">{{ user.email if user else '' }}</div>
        </div>
      </div>
      <a href="{{ url_for('mypage.profile_edit') }}"
         class="px-5 py-3 bg-blue-600 text-white rounded-lg text-base font-bold hover:bg-blue-700 transition-all duration-150"
         style="min-width:120px; text-align:center;">
        개인 정보 변경
      </a>
    </div>
    <div class="text-gray-600 text-sm">가입일: <span>{{ user.created_at if user and user.created_at else '-' }}</span></div>
    <form action="{{ url_for('mypage.user_delete') }}" method="post" class="mt-4">
      <button type="submit" class="px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600" onclick="return confirm('정말로 탈퇴하시겠습니까?\n이 작업은 되돌릴 수 없습니다.');">탈퇴하기</button>
    </form>
  </div>
  <hr class="my-6">
  <h2 class="text-xl font-semibold mb-3">내가 쓴 글</h2>
  <form id="multiDeleteForm" action="{{ url_for('mypage.multi_post_delete') }}" method="post">
    <ul class="space-y-2">
      {% if my_posts and my_posts|length > 0 %}
        {% for post in my_posts %}
          <li class="flex items-center gap-2">
            <input type="checkbox" name="post_ids" value="{{ post.id }}" class="form-checkbox h-4 w-4 text-blue-600">
            <a href="{{ url_for('posts.post_detail', id=post.id) }}" class="text-blue-700 hover:underline">{{ post.title }}</a>
          </li>
        {% endfor %}
        <li class="mt-3">
          <button type="submit" class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 text-sm" onclick="return confirm('선택한 글을 모두 삭제하시겠습니까?');">선택 삭제</button>
        </li>
      {% else %}
        <li class="text-gray-400">(여기에 내가 쓴 글 목록이 표시됩니다)</li>
      {% endif %}
    </ul>
  </form>
  <hr class="my-6">
  <h2 class="text-xl font-semibold mb-3">내가 쓴 댓글</h2>
  <form id="multiCommentDeleteForm" action="{{ url_for('mypage.multi_comment_delete') }}" method="post">
  <ul class="space-y-2">
    {% if my_comments and my_comments|length > 0 %}
      {% for comment in my_comments %}
        <li class="flex items-center gap-2">
          <input type="checkbox" name="comment_ids" value="{{ comment.id }}" class="form-checkbox h-4 w-4 text-blue-600">
          <span class="text-gray-800">{{ comment.content }}</span>
          <span class="text-xs text-gray-500">({{ comment.created_at }})</span>
          {% if comment.post_id %}
            <a href="{{ url_for('posts.post_detail', id=comment.post_id) }}" target="_blank" class="ml-2 px-2 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200">원문보기</a>
          {% endif %}
        </li>
      {% endfor %}
      <li class="mt-3">
        <button type="submit" class="px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 text-sm"
          onclick="return confirm('선택한 댓글을 모두 삭제하시겠습니까?');">선택 삭제</button>
      </li>
    {% else %}
      <li class="text-gray-400">(여기에 내가 쓴 댓글 목록이 표시됩니다)</li>
    {% endif %}
  </ul>
</form>
</div>
{% endblock %}
